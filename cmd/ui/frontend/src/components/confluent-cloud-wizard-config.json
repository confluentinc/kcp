{
  "id": "confluent-cloud-wizard",
  "title": "Confluent Cloud Setup Wizard",
  "description": "Configure your Confluent Cloud environment and cluster",
  "xstateMachine": {
    "id": "wizard",
    "initial": "environment-question",
    "context": {
      "stepData": {},
      "allData": {},
      "currentStep": "environment-question"
    },
    "states": {
      "environment-question": {
        "meta": {
          "title": "Environment Configuration",
          "schema": {
            "type": "object",
            "properties": {
              "needsEnvironment": {
                "type": "boolean",
                "title": "I need to create a new Confluent Cloud environment",
                "default": true
              }
            },
            "required": ["needsEnvironment"]
          },
          "uiSchema": {
            "needsEnvironment": {
              "ui:widget": "radio"
            }
          }
        },
        "on": {
          "NEXT": [
            {
              "target": "create-environment",
              "guard": "needsEnvironment",
              "actions": "saveStepData"
            },
            {
              "target": "cluster-question",
              "guard": "doesNotNeedEnvironment",
              "actions": "saveStepData"
            },
            {
              "target": "cluster-question",
              "guard": "needsEnvironment",
              "actions": "saveStepData"
            },
            {
              "target": "cluster-question",
              "guard": "doesNotNeedEnvironment",
              "actions": "saveStepData"
            }
          ]
        }
      },
      "create-environment": {
        "meta": {
          "title": "Create Confluent Cloud Environment and Cluster",
          "description": "Enter details for your new Confluent Cloud environment and cluster",
          "schema": {
            "type": "object",
            "properties": {
              "environmentName": {
                "type": "string",
                "title": "Environment Name",
                "description": "Name for your new Confluent Cloud environment"
              },
              "clusterName": {
                "type": "string",
                "title": "Cluster Name",
                "description": "Name for your new Confluent Cloud cluster"
              },
              "clusterType": {
                "type": "string",
                "enum": ["dedicated"],
                "title": "Cluster Type",
                "description": "Select the type of cluster"
              }
            },
            "required": ["environmentName", "clusterName", "clusterType"]
          },
          "uiSchema": {
            "environmentName": {
              "ui:placeholder": "e.g., production-env"
            },
            "clusterName": {
              "ui:placeholder": "e.g., production-cluster"
            },
            "clusterType": {
              "ui:widget": "select"
            }
          }
        },
        "on": {
          "NEXT": {
            "target": "review",
            "actions": "saveStepData"
          },
          "BACK": {
            "target": "environment-question"
          }
        }
      },
      "cluster-question": {
        "meta": {
          "title": "Cluster Configuration",
          "description": "Do you need to create a new cluster in your existing environment?",
          "schema": {
            "type": "object",
            "properties": {
              "needsCluster": {
                "type": "boolean",
                "title": "I need to create a new cluster",
                "default": false
              }
            },
            "required": ["needsCluster"]
          },
          "uiSchema": {
            "needsCluster": {
              "ui:widget": "radio"
            }
          }
        },
        "on": {
          "NEXT": [
            {
              "target": "create-cluster",
              "guard": "needsCluster",
              "actions": "saveStepData"
            },
            {
              "target": "review",
              "guard": "doesNotNeedCluster",
              "actions": "saveStepData"
            }
          ],
          "BACK": {
            "target": "environment-question"
          }
        }
      },
      "create-cluster": {
        "meta": {
          "title": "Create Confluent Cloud Cluster",
          "description": "Enter details for your new Confluent Cloud cluster",
          "schema": {
            "type": "object",
            "properties": {
              "environmentId": {
                "type": "string",
                "title": "Environment ID",
                "description": "ID of the Confluent Cloud environment"
              },
              "clusterName": {
                "type": "string",
                "title": "Cluster Name",
                "description": "Name for your new Confluent Cloud cluster"
              },
              "clusterType": {
                "type": "string",
                "enum": ["dedicated"],
                "title": "Cluster Type",
                "description": "Select the type of cluster"
              }
            },
            "required": ["environmentId", "clusterName", "clusterType"]
          },
          "uiSchema": {
            "environmentId": {
              "ui:placeholder": "e.g., env-xxxx"
            },
            "clusterName": {
              "ui:placeholder": "e.g., production-cluster"
            },
            "clusterType": {
              "ui:widget": "select"
            }
          }
        },
        "on": {
          "NEXT": {
            "target": "review",
            "actions": "saveStepData"
          },
          "BACK": {
            "target": "cluster-question"
          }
        }
      },
      "review": {
        "meta": {
          "title": "Review Configuration",
          "description": "Review your Confluent Cloud configuration",
          "type": "review",
          "summaryFields": [
            "hasExistingEnvironment",
            "environmentName",
            "needsCluster",
            "clusterName",
            "clusterType"
          ]
        },
        "on": {
          "SUBMIT": {
            "target": "complete",
            "actions": "saveStepData"
          },
          "BACK": [
            {
              "target": "create-environment",
              "guard": "cameFromCreateEnvironment"
            },
            {
              "target": "create-cluster",
              "guard": "cameFromCreateCluster"
            },
            {
              "target": "cluster-question",
              "guard": "cameFromClusterQuestion"
            }
          ]
        }
      },
      "complete": {
        "type": "final",
        "meta": {
          "title": "Configuration Complete",
          "message": "Your Confluent Cloud configuration is ready to be processed...",
          "apiEndpoint": "/api/assets"
        }
      }
    }
  },
  "guards": {
    "needsEnvironment": "event && event.data && event.data.needsEnvironment === true",
    "doesNotNeedEnvironment": "event && event.data && event.data.needsEnvironment === false",
    "needsCluster": "event && event.data && event.data.needsCluster === true",
    "doesNotNeedCluster": "event && event.data && event.data.needsCluster === false",
    "cameFromCreateEnvironment": "context && context.previousStep === 'create-environment'",
    "cameFromCreateCluster": "context && context.previousStep === 'create-cluster'",
    "cameFromClusterQuestion": "context && context.previousStep === 'cluster-question'"
  },
  "actions": {
    "saveStepData": "assign({ stepData: (context, event) => ({ ...context.stepData, [event.stepId]: event.data }), allData: (context, event) => ({ ...context.allData, [event.stepId]: event.data }), previousStep: (context, event) => event.stepId })"
  }
}
