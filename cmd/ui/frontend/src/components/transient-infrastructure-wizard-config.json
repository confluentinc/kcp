{
  "id": "transient-infrastructure-wizard",
  "title": "Transient Infrastructure Setup Wizard",
  "description": "Configure transient infrastructure for migration",
  "xstateMachine": {
    "id": "wizard",
    "initial": "msk_publicly_accessible",
    "context": {
      "stepData": {},
      "allData": {},
      "currentStep": "msk_publicly_accessible"
    },
    "states": {
      "msk_publicly_accessible": {
        "meta": {
          "title": "Is your MSK cluster accessible from the internet?",
          "schema": {
            "type": "object",
            "properties": {
              "msk_publicly_accessible": {
                "type": "string",
                "title": "Is your MSK cluster accessible from the internet?",
                "enum": ["yes", "no"],
                "enumNames": ["Yes", "No"]
              }
            },
            "required": ["msk_publicly_accessible"]
          },
          "uiSchema": {
            "msk_publicly_accessible": {
              "ui:widget": "radio"
            }
          }
        },
        "on": {
          "NEXT": {
            "target": "authentication_method_question",
            "actions": "save_step_data"
          }
        }
      },
      "authentication_method_question": {
        "meta": {
          "title": "Authentication Method",
          "description": "Which authentication method will you use for the cluster link?",
          "schema": {
            "type": "object",
            "properties": {
              "authentication_method": {
                "type": "string",
                "title": "Which authentication method will you use for the cluster link?",
                "enum": ["iam", "sasl_scram"],
                "enumNames": ["IAM", "SASL/SCRAM"]
              }
            },
            "required": ["authentication_method"]
          },
          "uiSchema": {
            "authentication_method": {
              "ui:widget": "radio"
            }
          }
        },
        "on": {
          "NEXT": [
            {
              "target": "cluster_type_question",
              "guard": "is_sasl_scram",
              "actions": "save_step_data"
            },
            {
              "target": "authentication_method_question"
            }
          ],
          "BACK": [
            {
              "target": "cluster_type_question",
              "guard": "msk_publicly_accessible"
            }
          ]
        }
      },
      "cluster_type_question": {
        "meta": {
          "title": "Target Cluster Type",
          "description": "Select the type of your target Confluent Cloud cluster",
          "schema": {
            "type": "object",
            "properties": {
              "target_cluster_type": {
                "type": "string",
                "title": "Is the target Confluent Cloud cluster 'Dedicated' or 'Enterprise'?",
                "enum": ["dedicated", "enterprise"],
                "enumNames": ["Dedicated", "Enterprise"]
              }
            },
            "required": ["target_cluster_type"]
          },
          "uiSchema": {
            "target_cluster_type": {
              "ui:widget": "radio"
            }
          }
        },
        "on": {
          "NEXT": [
            {
              "target": "dedicated_inputs",
              "guard": "is_dedicated",
              "actions": "save_step_data"
            }
          ]
        }
      },
      "dedicated_inputs": {
        "meta": {
          "title": "Dedicated Cluster Configuration",
          "description": "Enter configuration details for your Dedicated cluster",
          "schema": {
            "type": "object",
            "properties": {
              "target_environment_id": {
                "type": "string",
                "title": "Environment ID",
                "description": "Confluent Cloud Environment ID"
              },
              "target_cluster_id": {
                "type": "string",
                "title": "Cluster ID",
                "description": "Confluent Cloud Cluster ID"
              },
              "target_rest_endpoint": {
                "type": "string",
                "title": "REST Endpoint",
                "description": "Confluent Cloud Cluster REST Endpoint"
              }
            },
            "required": [
              "target_environment_id",
              "target_cluster_id",
              "target_rest_endpoint"
            ]
          },
          "uiSchema": {
            "target_environment_id": {
              "ui:placeholder": "e.g., env-xxxxx"
            },
            "target_cluster_id": {
              "ui:placeholder": "e.g., cluster-xxxxx"
            },
            "target_rest_endpoint": {
              "ui:placeholder": "e.g., https://api.confluent.cloud"
            }
          }
        },
        "on": {
          "NEXT": {
            "target": "statefile_inputs",
            "actions": "save_step_data"
          },
          "BACK": {
            "target": "cluster_type_question"
          }
        }
      },
      "statefile_inputs": {
        "meta": {
          "title": "Statefile Configuration",
          "description": "Enter configuration details for your statefile",
          "schema": {
            "type": "object",
            "properties": {
              "msk_cluster_id": {
                "type": "string",
                "title": "Environment ID",
                "description": "Confluent Cloud Environment ID"
              },
              "msk_cluster_bootstrap_brokers": {
                "type": "string",
                "title": "Cluster ID",
                "description": "Confluent Cloud Cluster ID"
              }
            },
            "required": ["msk_cluster_id", "msk_cluster_bootstrap_brokers"]
          },
          "uiSchema": {
            "msk_cluster_id": {
              "ui:placeholder": "e.g., env-xxxxx"
            },
            "msk_cluster_bootstrap_brokers": {
              "ui:placeholder": "e.g., b-1.examplecluster.0abcde.c.us-west-2.msk.amazonaws.com:9098,b-2.examplecluster.0abcde.c.us-west-2.msk.amazonaws.com:9098"
            }
          }
        },
        "on": {
          "NEXT": {
            "target": "review",
            "actions": "save_step_data"
          },
          "BACK": {
            "target": "dedicated_inputs"
          }
        }
      },
      "review": {
        "meta": {
          "title": "Review Configuration",
          "description": "Review your transient infrastructure configuration",
          "type": "review",
          "summaryFields": [
            "msk_publicly_accessible",
            "target_cluster_type",
            "target_environment_id",
            "target_cluster_id",
            "target_rest_endpoint",
            "authentication_method"
          ]
        },
        "on": {
          "SUBMIT": {
            "target": "complete",
            "actions": "save_step_data"
          },
          "BACK": [
            {
              "target": "statefile_inputs",
              "guard": "came_from_statefile_inputs"
            }
          ]
        }
      },
      "complete": {
        "type": "final",
        "meta": {
          "title": "Configuration Complete",
          "message": "Your transient infrastructure configuration is ready to be processed...",
          "apiEndpoint": "/api/assets/migration/cluster_arn_placeholder"
        }
      }
    }
  },
  "guards": {
    "is_dedicated": "event && event.data && event.data.target_cluster_type === 'dedicated'",
    "is_enterprise": "event && event.data && event.data.target_cluster_type === 'enterprise'",
    "is_iam": "event && event.data && event.data.authentication_method === 'iam'",
    "is_sasl_scram": "event && event.data && event.data.authentication_method === 'sasl_scram'",
    "came_from_dedicated_inputs": "context && context.previousStep === 'dedicated_inputs'",
    "came_from_statefile_inputs": "context && context.previousStep === 'statefile_inputs'"
  },
  "actions": {
    "save_step_data": "assign({ stepData: (context, event) => ({ ...context.stepData, [event.stepId]: event.data }), allData: (context, event) => ({ ...context.allData, [event.stepId]: event.data }), previousStep: (context, event) => event.stepId })"
  }
}
